<!DOCTYPE HTML>
<html>
  <head>
    <title>WebSocket echo test</title>
    <script>

    var lastMessage;

    window.onload = function () {
      // create socket
      var client = new WebSocket('ws://localhost:3000', 'echo-protocol');

      client.onerror = function () {
        console.log('Connection Error');
      }

      client.onopen = function (evt) {
        console.log('WebSocket Client Connected');
        // send first ping
        ping();
      };

      client.onmessage = function (evt) {
        //alert( "Received Message: " + evt.data);

        console.log(' got: ' + event.data);
        // you got echo back, measure latency
        document.getElementById('latency').innerHTML = new Date() - lastMessage
           +'ms';
        // ping again
        //ping();
      }

      client.onclose = function () {
        console.log("echo-protocol Client Closed");
      }

      function ping() {
        // record the timestamp
        lastMessage = new Date();

        // send the message
        if (client.readyState === client.OPEN) {
          client.send('ping');
        }
      }
    };

    </script>
  </head>
  <body>
    <h1>WebSocket Echo</h1>
    <h2>Latency: <span id="latency"></span></h2>
  </body>
</html>
